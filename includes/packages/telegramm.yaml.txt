## коды эмоджи для телеграмм - https://unicode.org/Public/emoji/13.1/emoji-test.txt
## коды эмоджи для телеграмм - https://apps.timwhitlock.info/emoji/tables/unicode

telegramm:


    sensor:

      - platform: template
        sensors:

          unavailable_now_light:
            friendly_name: "Всего недоступных светильников - "
            entity_id:
              - sensor.time
            value_template: "{{states.light | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon_template: mdi:counter        

          unavailable_now_switch:
            friendly_name: "Всего недоступных реле - "
            entity_id:
              - sensor.time
            value_template: "{{states.switch | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon_template: mdi:counter 
            
          unavailable_now_sensor:
            friendly_name: "Всего недоступных сенсоров - "
            entity_id:
              - sensor.time
            value_template: "{{states.sensor | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon_template: mdi:counter
            
          unavailable_now_binary_sensor:
            friendly_name: "Всего недоступных бинарных сенсоров - "
            entity_id:
              - sensor.time
            value_template: "{{states.binary_sensor | selectattr ('state', 'equalto', 'unavailable') | list | length}}"
            icon_template: mdi:counter

    script:
    
      send_message_1:
        alias: Отправка через сервис уведомлений
        sequence:
        - service: notify.telegram_id_1
          data:
            message: "Текущее время - {{ states('sensor.time') }} . Все в порядке"
        - service: notify.telegram_id_2
          data:
            message: "Текущее время - {{ states('sensor.time') }} . Все в порядке"

      system_report:
        alias: Отправка отчета о состоянии системы
        sequence:
         - service: notify.telegram_id_1
           data:
             message: | 
                 {{"\U0001F310"}} Состояние системы
                 {{"\U0001F550"}} Отчет за {{ states('sensor.time_date') }}
                 {{"\U0001F4A1"}} Светильников недоступно - {{ states('sensor.unavailable_now_light') }} 
                 {{"\U0001F50C"}} Свичей недоступно - {{ states('sensor.unavailable_now_switch') }} 
                 {{"\U0001F321"}} Сенсоров недоступно - {{ states('sensor.unavailable_now_sensor') }} 
                 {{"\U0001F51F"}} Бинарных сенсоров недоступно - {{ states('sensor.unavailable_now_binary_sensor') }}
         - service: notify.telegram_id_2
           data:
             message: | 
                 {{"\U0001F310"}} Состояние системы
                 {{"\U0001F550"}} Отчет за {{ states('sensor.time_date') }}
                 {{"\U0001F4A1"}} Светильников недоступно - {{ states('sensor.unavailable_now_light') }} 
                 {{"\U0001F50C"}} Свичей недоступно - {{ states('sensor.unavailable_now_switch') }} 
                 {{"\U0001F321"}} Сенсоров недоступно - {{ states('sensor.unavailable_now_sensor') }} 
                 {{"\U0001F51F"}} Бинарных сенсоров недоступно - {{ states('sensor.unavailable_now_binary_sensor') }}


    automation:   
    
        - id: Отчет при запуске системы
          alias: start_message
          initial_state: true
          trigger:   
             - platform: homeassistant
               event: start          
          action:          
             - service: notify.telegram_id_1
               data:
                 message: | 
                     {{"\U0001F4AC"}} Cервер My Home 
                     {{"\U0001F680"}} Зафиксирован запуск в {{ states('sensor.time_date') }} 
                     {{"\U0001F4C3"}} Отчет о состоянии будет через 1 минуту
             - service: notify.telegram_id_2
               data:
                 message: | 
                     {{"\U0001F4AC"}} Cервер My Home 
                     {{"\U0001F680"}} Зафиксирован запуск в {{ states('sensor.time_date') }} 
                     {{"\U0001F4C3"}} Отчет о состоянии будет через 1 минуту
             - delay: 00:01:10
             - service: script.turn_on
               entity_id: script.system_report

        - id: Запрос на отчет             
          alias: send_report
          initial_state: true
          trigger:
          - platform: event
            event_type: telegram_command
            event_data:
              command: '/report'
          action:
           - service: script.turn_on
             entity_id: 
                - script.system_report

        - id: Включить свет в коридоре            
          alias: send_light
          initial_state: true
          trigger:
          - platform: event
            event_type: telegram_command
            event_data:
              command: '/light'
          action:
           - service: switch.turn_on
             entity_id: 
                - switch.sonoff_10010f2f6c

        - id: Уведомление о включении света в коридоре            
          alias: send_light_on
          initial_state: true
          trigger:
          - platform: state
            entity_id: switch.sonoff_10010f2f6c
            to: 'on'
          action:
          - service: notify.telegram_id_1
            data:
              message: "Свет в коридоре включен в - {{ states('sensor.time') }} "

        - id: Клавиатура телеграмм бота
          alias: telegram_keyboard
          initial_state: true
          trigger:
          - platform: event
            event_type: telegram_command
            event_data:
              command: '/start'
          action:
          - service: notify.telegram_id_1
            data:
              message: 'commands'
              data:
                keyboard:
                  - '/report, /light'
                  - '/forecast, /light2, /light3'
                  - '/report3, /light4, /light5'
          - service: notify.telegram_id_2
            data:
              message: 'commands'
              data:
                keyboard:
                  - '/report, /light'
                  - '/forecast, /light2, /light3'
                  - '/report3, /light4, /light5'



